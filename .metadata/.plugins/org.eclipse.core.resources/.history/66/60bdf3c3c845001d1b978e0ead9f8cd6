package com.tests;

import java.time.Duration;
import java.util.Properties;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.firefox.FirefoxDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;

import com.home.page.HomePage;
import com.login.page.LoginPage;
import com.utility.CommonUtilities;

import io.cucumber.java.After;
import io.cucumber.java.Before;
import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import io.github.bonigarcia.wdm.WebDriverManager;

public class SalesforceLoginStepDefination {
	public static WebDriver driver=null;
	public static  WebDriverWait wait=null;
	LoginPage login;
	HomePage homepage;
	
	@Before
	public void setup() {
		WebDriverManager.firefoxdriver().setup();
		driver=new FirefoxDriver();
		driver.manage().timeouts().pageLoadTimeout(Duration.ofSeconds(30));
		
	}
	
	@Given("when you go to url")
	public void when_you_go_to_url() {
		CommonUtilities cu = new CommonUtilities();
		Properties applicationPropertiesFile=cu.loadFile("applicationProperties");
		String url= cu.getApplicationProperty("url", applicationPropertiesFile);
		driver.get(url);
		driver.manage().window().maximize();
	    sleep(2);
	   
	}

	public void sleep(int i) {
		try {
			Thread.sleep(i*1000);
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	@When("i enter value of username")
	public void i_enter_value_of_username() {
		
		CommonUtilities cu = new CommonUtilities();
		Properties applicationPropertiesFile=cu.loadFile("applicationProperties");
		String valid_username= cu.getApplicationProperty("vaild_username", applicationPropertiesFile);
		
		login = new LoginPage(driver);
		login.enterUserName(valid_username);
		
	/*	wait = new WebDriverWait(driver, Duration.ofSeconds(30));
		
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//*[@id=\"username\"]")));
		WebElement username = driver.findElement(By.id("username"));
		username.clear();
		username.sendKeys(valid_username);*/
		
	}
	@When("i enter value of password")
	public void i_enter_value_of_password() {
		
		CommonUtilities cu = new CommonUtilities();
		Properties applicationPropertiesFile=cu.loadFile("applicationProperties");
		String valid_Password= cu.getApplicationProperty("valid_Password", applicationPropertiesFile);
		login = new LoginPage(driver);
		login.enterUserName(valid_Password);
	/*	wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//*[@id=\"password\"]")));
		WebElement password = driver.findElement(By.id("password"));
		password.clear();
		password.sendKeys(valid_Password);*/
	   
	}
	@When("click on login button")
	public void click_on_login_button() {
		login = new LoginPage(driver);
		login.clickLoginButton();
		/*wait = new WebDriverWait(driver, Duration.ofSeconds(30));
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("Login")));
		WebElement loginbutton = driver.findElement(By.id("Login"));
		loginbutton.click();*/
		
	   
	}
	@Then("i should get the page title")
	public void i_should_get_the_page_title() {
		String expected="Home Page ~ Salesforce - Developer Edition";
		
		homepage = new HomePage(driver);
		String accepted= homepage.displayPageTitle();
		Assert.assertEquals(accepted, expected);
		
		/*wait = new WebDriverWait(driver, Duration.ofSeconds(30));
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.linkText("Home")));
		String actual=driver.getTitle();
		Assert.assertEquals(actual, expected);*/
		
	  
	}

	
	@After
	public void tearDown() {
		sleep(2);
		driver.close();
	}
}
